#!/usr/bin/env node

var https = require('https');
var url = require('url');
var fs = require('fs');

function downloadSchema(schema) {
  var options = url.parse(schema.download_url);
  options.headers = {
    'User-Agent': 'PopIt https://popit.mysociety.org',
  };
  https.get(options, function(res) {
    res.pipe(fs.createWriteStream(__dirname + '/../schemas/popolo/' + schema.name));
  });
}

function main() {
  var schemasUrl = 'https://api.github.com/repos/popolo-project/popolo-spec/contents/schemas';
  var options = url.parse(schemasUrl);
  options.headers = {
    'User-Agent': 'https://popit.mysociety.org',
  };
  https.get(options, function(res) {
    var body = '';
    res.on('data', function(chunk) {
      body += chunk;
    });
    res.on('end', function() {
      var schemas = JSON.parse(body);
      schemas.forEach(function(schema) {
        downloadSchema(schema);
      });
    });
  });
}

main();
